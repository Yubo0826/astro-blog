---
heroImage: /src/assets/images/bg.jpg
category: Security
description: 常見網路攻擊CSRF的介紹與防禦
pubDate: 2025-02-04T16:00:00.000Z
tags:
  - CSRF
  - Security
title: CSRF（Cross-Site Request Forgery）介紹與防禦措施
---

## CSRF 簡介

### 攻擊機制

受害者進入第三方網站，在第三方網站中，向被攻擊網站發送跨站請求，執行未經授權的操作，如轉帳、修改密碼等。

### 攻擊流程

* 受害者登入a.com，並保留了登入記錄（Cookie）
* 攻擊者引誘受害者造訪了 b.com
* b.com 在受害者不知情的情況下，向 a.com 發送了一個請求
* a.com 接收到請求後，對請求進行驗證，並確認是受害者的請求，誤認為是受害者發送自己的請求
* a.com 以受害者的名義執行了 act=xx
* 攻擊完成，攻擊者在受害者不知情的情況下，冒充受害者，讓 a.com 執行自己定義的操作

CSRF 可以透過get請求，即透過造訪img的頁面後，瀏覽器自動存取目標位址，發送請求。

同樣，也可以設定一個自動提交的表單發送post請求，如下：

```html
<form action="http://bank.example/withdraw" method=POST>
    <input type="hidden" name="account" value="xiaoming" />
    <input type="hidden" name="amount" value="10000" />
    <input type="hidden" name="for" value="hacker" />
</form>
<script> document.forms[0].submit(); </script>
```

* 造訪該頁面後，表單會自動提交，相當於模擬使用者完成了一次POST操作。
* 還有一種使用a標籤的，需要使用者點擊連結才會觸發。\
  \< a href="http\://test.com/csrf/withdraw\.php?amount=1000\&for=hacker" taget="\_blank"> 抽獎請點擊這！！\<a/>
* 造訪該頁面後，表單會自動提交，相當於模擬使用者完成了一次POST操作。

### CSRF的特點

* 攻擊一般在第三方網站發起，而不是被攻擊的網站。
* 攻擊利用受害者在被攻擊網站的登入資源，冒充受害者的操作方式；而不是直接竊取數據
* 整個過程攻擊者並不能取得受害者的登入券，相反地“冒用”
* 跨站請求可以採用多種方式：圖片URL、超連結、CORS、表單提交等。

## CSRF 防禦方法

### 1. CSRF Token

每次發送請求時，伺服器都要求帶上一個隨機生成的 CSRF Token，攻擊者無法輕易獲取這個 Token，因此無法偽造請求。

實作方式：
